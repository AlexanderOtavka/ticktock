<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../bower_components/paper-item/paper-icon-item.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../calendar-icon/calendar-icon.html">
<link rel="import" href="../dropdown-menu/dropdown-menu.html">
<link rel="import" href="../ticktock-icons/ticktock-icons.html">

<dom-module id="selectable-calendar">

<style>
  :host {
    display: block;
  }

  paper-icon-button {
    color: var(--light-icon-color);
  }

  paper-icon-item {
    font-size: var(--calendar-font-size);
    padding-right: 2px;
    --paper-item-focused-before: {
      background-color: rgba(0, 0, 0, 0);
    }
  }

  .hidden {
    opacity: 0.7;
  }

  #name {
    @apply(--layout-flex);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
</style>

<template>
  <paper-icon-item>
    <calendar-icon
      color="[[color]]"
      icon="[[_getIcon(icon, calendarHidden)]]"
      faded="[[calendarHidden]]"
      item-icon>
    </calendar-icon>
    <span id="name" class$="[[_getHiddenClass(calendarHidden)]]">
      [[name]]
    </span>

    <dropdown-menu
      horizontal-align="left"
      horizontal-offset="0"
      vertical-offset="0"
      hidden="[[noMenu]]">
      <paper-icon-button
        icon="icons:more-vert"
        class="dropdown-trigger">
      </paper-icon-button>

      <div class="dropdown-content">
        <paper-item on-tap="toggleHide">
          <div>[[_getHideButtonText(calendarHidden)]]</div>
        </paper-item>
      </div>
    </dropdown-menu>
  </paper-icon-item>
</template>

<script>
(function () {
  'use strict';

  Polymer({
    is: 'selectable-calendar',

    properties: {
      color: String,
      icon: {
        type: String,
        value: '',
      },
      name: String,
      calendarId: String,
      calendarHidden: {
        type: Boolean,
        notify: true,
        value: false,
      },
      noMenu: Boolean,
    },

    attached: function () {
      this.$$('dropdown-menu').onclick = function (event) {
        event.stopPropagation();
        return false;
      };
    },

    toggleHide: function (event) {
      this.calendarHidden = !this.calendarHidden;
      event.stopPropagation();
    },

    _getIcon: function (icon, calendarHidden) {
      return icon || (calendarHidden ? 'ticktock:calendar-hidden' :
                                       'ticktock:calendar');
    },

    _getHideButtonText: function (calendarHidden) {
      return calendarHidden ? 'Unhide' : 'Hide';
    },

    _getHiddenClass: function (calendarHidden) {
      return calendarHidden ? 'hidden' : '';
    },
  });
})();
</script>

</dom-module>
